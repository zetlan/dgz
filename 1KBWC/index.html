<html>
	<head>
		<!--
		Copyright Cynthia Clementine
		October-16-2021
		cards were largely not made by me, I am simply documenting them.
		-->
		<title>1000 blank white cards - web access</title>
		<meta charset="UTF-8">
		<link rel='icon' href='all-card-images/bwcCover.png' type='image/png'/>
		<style>
			/*buttons*/
			button {
				border: none;
				background-color: white;
				text-align: center;
				transition-duration: 0.4s;
				color: black;
				border: none;
				height: 25px;
			}

			button:hover {
				background-color: slateblue;
			}

			/*main DOM*/
			body {
				background-color: rgb(137, 123, 232);
				margin: 0;
				padding: 0;
			}

			label {
				white-space: nowrap;
			}

			#topBar {
				text-align: center;
				margin: auto;
			}

			#centerModule {
				line-height: 0;
				column-count:         5;
				column-gap:           0px;
				text-align: center;
			}

			#centerModule img {
				margin: auto;
				margin-top: 2%;
				margin-left: 10%;
				margin-right: 10%;
				width: 80%;
				height: auto;
			}

			@media (max-width: 1600px) {
				#centerModule {
					column-count:         4;
				}
			}

			@media (max-width: 1200px) {
				#centerModule {
					column-count:         3;
				}
			}

			@media (max-width: 1000px) {
				#centerModule {
					column-count:         2;
				}
			}
			
			@media (max-width: 400px) {
				#centerModule {
					column-count:         1;
				}
			}

			.selection {
				position: relative;
				display: inline-block;
			}

			.selectionContent {
				display: none;
				position: absolute;
				background-color: rgb(186, 177, 247);
				min-width: 160px;
				z-index: 1;
			}

			.selection:hover .selectionContent {
				display: block;
			}

			.selectionContent input {
				color: black;
				padding: 12px 16px;
				display: inline-block;
			}

			#download {
				display: none;
			}

			#a {
				line-height: 200px;
				text-align: center;
			}
		</style>
		<script src="data.js"></script>
		<script type="text/javascript">
			window.onload = setup;

			var cardDataPulling = [];

			var imageHeightLimit = 150;
			var imageAspectRatio = 0.6;
			var allImagesShown = false;
			var selectorSettings = {
				posStrings: [`A`, `B`, `C`, `D`, `E`, `F`, `G`, `H`, `I`, `J`, `K`, `L`, `M`, `N`, `O`, `P`, `Q`, `R`, `S`, `T`, `U`, `V`, `W`, `X`, `Y`, `Z`, `non-letter start`, `number start`],
				negStrings: []
			};
			var applyingTags = [];
			var searchStr = "";

			const color_withTags = `rgb(0, 255, 0)`;
			const color_withoutTags = `rgb(255, 0, 255)`;


			function setup() {
				formatArray();
				createSearchButtons();
				createImageGrid();

				//update title number
				document.getElementById("cardNumDisplay").innerHTML = `are ${cardData.length} cards.`;
			}

			function createImageGrid() {
				//turn all elements in the card array into clickable links
				var bufferLocation = document.getElementById("centerModule");
				var linkElem;
				var imagElem;
				//var divElem;
				for (var c=0; c<cardData.length; c++) {
					//image to go inside the link with title
					imagElem = document.createElement("img");
					imagElem.loading = "lazy";
					imagElem.src = `all-card-images/card~${cardData[c].id}.${cardData[c].imgType || "png"}`;
					imagElem.style = `display: inline-block;`;
					imagElem.classList.add("labelImage");
					//get just the number as the ID
					imagElem.id = cardData[c].id + "_img";
					imagElem.alt = cardData[c].name;

					//create link element and then put it in the main center column
					linkElem = document.createElement("a");
					linkElem.target = "_blank";
					//linkElem.innerHTML = cardData[c].name;
					linkElem.href = `card.html#${cardData[c].id}`;
					linkElem.maxWidth = `100px`;
					linkElem.id = cardData[c].id + "_link";
					linkElem.appendChild(document.createElement("br"));
					linkElem.appendChild(imagElem);

					bufferLocation.appendChild(linkElem);
				}
			}

			function createSearchButtons() {
				var checkElem;
				var labelElem;
				var bufferLocationPositive = document.getElementById("SMPspot");
				var bufferLocationNegative = document.getElementById("SMNspot");
				cardPossibleTags.forEach(s => {
					//positive tags
					checkElem = document.createElement("input");
					checkElem.type = "checkbox";
					checkElem.id = `pos_${s}`;
					checkElem.checked = selectorSettings.posStrings.includes(s);
					checkElem.setAttribute(`onclick`, `toggleSelector("${s}", selectorSettings.posStrings);`);
					labelElem = document.createElement("label");
					labelElem.for = `pos_${s}`;
					labelElem.innerHTML = s;

					bufferLocationPositive.appendChild(checkElem);
					bufferLocationPositive.appendChild(labelElem);
					bufferLocationPositive.appendChild(document.createElement("br"));

					//negative tags
					checkElem = document.createElement("input");
					checkElem.type = "checkbox";
					checkElem.id = `neg_${s}`;
					checkElem.setAttribute(`onclick`, `toggleSelector("${s}", selectorSettings.negStrings);`);
					labelElem = document.createElement("label");
					labelElem.for = `neg_${s}`;
					labelElem.innerHTML = s;

					bufferLocationNegative.appendChild(checkElem);
					bufferLocationNegative.appendChild(labelElem);
					bufferLocationNegative.appendChild(document.createElement("br"));

				});
			}

			function addTagTo(tag, cardNames) {
				cardNames.forEach(n => {
					//loop through all cards
					for (var r=0; r<cardData.length; r++) {
						//if the card has the correct name, give it the tag
						if (cardData[r].name == n) {
							if (cardData[r].tags.indexOf(tag) == -1) {
								cardData[r].tags.push(tag);
							}
							return;
						}
					}
					//if finished the loop, realize it's a problem
					console.error(`could not find card with name ${n}!`);
				});
			}

			function formatArray() {
				var hiddenOnes = [];
				//destroy hiddens
				for (var c=0; c<cardData.length; c++) {
					if (cardData[c].hide == true) {
						cardData.splice(c, 1);
						c -= 1;
					}
				}

				//next sort the array CORRECTLY
				cardData.sort((a, b) => {
					return a.name.toLowerCase().localeCompare(b.name.toLowerCase());
				});
			}

			function toggleImages() {
				//decide which way self is going
				allImagesShown = !allImagesShown;
				var newDisplay = allImagesShown ? "inline-block" : "none";

				//loop through all links in the center module
				var collectRef = document.getElementById("centerModule").children;
				for (var n=0; n<collectRef.length; n++) {
					collectRef[n].children[1].style.display = newDisplay;
				}
			}

			function toggleImage(imgNum) {
				var ref = document.getElementById(imgNum + "_img");
				ref.style.display = (ref.style.display == "none") ? "inline-block" : "none";
			}

			function toggleSelector(str, arr) {
				var elem = document.getElementById(str);
				//if the string is already in the array, remove it. If not, add it.
				//Basically toggle whether the string is in the array or not
				if (arr.includes(str)) {
					arr.splice(arr.indexOf(str), 1)
				} else {
					arr.push(str);
				}

				updateCardsVisibility();
			}

			//changes the function of clicking on images. Normal users won't access this, but it makes adding tags to the database handy for me.
			function toggleTagApplication(tag) {
				var startTagNum = applyingTags.length;
				var index = applyingTags.indexOf(tag);

				if (index != -1) {
					//if the tag is already being applied, disable it
					applyingTags.splice(index, 1);
				} else {
					applyingTags.push(tag);
				}

				var targetArr = document.getElementById("centerModule").children;

				//if this is the first tag, change link behavior
				if (startTagNum == 0) {
					for (var g=0; g<targetArr.length; g++) {
						var cardNum;
						try {
							cardNum = targetArr[g].id.split("_")[0];
						} catch (er) {
							console.error(er, g, `couldn't find ${targetArr[g]}`);
						}
						targetArr[g].href = `javascript: toggleTags(${cardNum}, "${targetArr[g].id}");`;
						//color text based on whether they have the tags or not
						targetArr[g].style.color = (getCardFromID(cardNum).tags.includes(applyingTags[0])) ? color_withTags : color_withoutTags;
					}
					return;
				}

				//if there are no tags left, revert to normal behavior
				if (applyingTags.length == 0) {
					for (var g=0; g<targetArr.length; g++) {
						targetArr[g].href = `card.html#${targetArr[g].id.split("_")[0]}`;
						targetArr[g].style.color = '';
					}
					return;
				}
			}

			function toggleTags(forCard, forHTMLObj) {
				var cardObj = getCardFromID(forCard);

				applyingTags.forEach(t => {
					tagForObject(cardObj, t);
				});

				//toggle the color of the HTML object
				var ref = document.getElementById(forHTMLObj);
				ref.style.color = (ref.style.color == color_withTags) ? color_withoutTags : color_withTags;
			}

			function updateCardsVisibility() {
				var cardsVisible = 0;
				//first do positive selectors
				cardData.forEach(card => {
					//inclusive means that if the card contains any of the added tags, it will be displayed
					if (card.tags.some(item => selectorSettings.posStrings.includes(item))) {
						document.getElementById(card.id + "_link").style.display = "inline-block";
						cardsVisible += 1;
					} else {
						document.getElementById(card.id + "_link").style.display = "none";
					}
				});

				//negative selectors
				cardData.forEach(card => {
					//exclusive means that if the card contains any of the added tags, it will be forcibly undisplayed. Do not display it if it doesn't match tags though.
					if (card.tags.some(item => selectorSettings.negStrings.includes(item))) {
						if (document.getElementById(card.id + "_link").style.display == "inline-block") {
							document.getElementById(card.id + "_link").style.display = "none";
							cardsVisible -= 1;
						}
					}
				});

				//search text
				searchStr = document.getElementById("searchBox").value;
				cardData.forEach(card => {
					//make sure cards going to be displayed include what's being searched
					if (document.getElementById(card.id + "_link").style.display == "inline-block") {
						if (!document.getElementById(card.id + "_img").alt.toLowerCase().includes(searchStr.toLowerCase())) {
							document.getElementById(card.id + "_link").style.display = "none";
							cardsVisible -= 1;
						}
					}
				});

				//update title text
				if (cardsVisible == 1) {
					document.getElementById("cardNumDisplay").innerHTML = `is 1 card.`;
				} else {
					document.getElementById("cardNumDisplay").innerHTML = `are ${cardsVisible} cards.`;
				}
				document.getElementById("cardNumDisplayExtra").innerHTML = (cardsVisible != cardData.length) ? ` (${cardData.length} total)` : ``;
			}
		</script>
		
		
	</head>
	<body>
		<div id="topBar">
			<h1>There <span id="cardNumDisplay">are [[NUMBER UNAVAILABLE]] cards.</span><span id="cardNumDisplayExtra"></span></h1>
			<h7><a href="about.html">About</a> ~~~ <a href="contact.html">Contact</a></h7>
			<br>
			<div class="selection" id="selectionModule_p">
				<button class="SMButton">Include Tags</button>
				<div class="selectionContent" id="SMPspot">
				</div>
			</div>
			<div class="selection" id="selectionModule_n">
				<button class="SMButton">Exclude Tags</button>
				<div class="selectionContent" id="SMNspot">
				</div>
			</div>
			<br>
			<!-- <button onclick="toggleImages()">Toggle All Image Previews</button><br> -->
			<input id="searchBox" placeholder="Search for a card" oninput="updateCardsVisibility();">
		</div>
		<br>
		<br>
		<div id="centerModule">
		</div>
		<!--the download link-->
		<a id="download" download="cardData.txt"></a>
	</body>
</html>