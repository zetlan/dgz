<html>
	<!--
		Copyright Davis Zetlan
		July-9-2020
	-->

	<head>
		<title>Text Helper</title>
		<style>
			body {
				background-color: slateblue;
			}

			#coco { 
				display: block;
			}

			#centerModule {
				text-align: center;
				margin: auto;
			}
		</style>
        
        <script>
            window.onload = setup;
            window.addEventListener("keydown", handleKeyPress, false);

            //vars
            var canvas;
            var ctx;
            var boxList = [null];
            var trimmedTextList = [];
            var boxNextID = 1;


            //functions
            function setup() {
                canvas = document.getElementById("coco");
                ctx = canvas.getContext("2d");

                updateCanvas();
            }

            function updateCanvas() {
                //paint background
                ctx.fillStyle = "#4488CC";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                //paint box
                ctx.fillStyle = "#2244FF";
                ctx.fillRect(0, canvas.width * 0.5, canvas.width, canvas.height * 0.5);

                //drawing text
            }

            function updateStoredText() {
                //loop through all the possible boxes
                for (var a=0;a<boxList.length;a++) {
                    //replace the element of the array with the text in the selected box
                    var replaceText = null;
                    try {
                        replaceText = document.getElementById(a + "-text").value;
                    } catch (eaSportsItsInTheGame) {
                        eplaceText = null;
                    }
                    boxList[a] = replaceText;
                    console.log("yues");
                }


                //loop through all elements of the stored text
                trimmedTextList = [];
                for (var b=0;b<boxList.length;b++) {
                    //if there's text, perform operations on it
                    if (boxList[b] != null) {
                        //determine who is speaking
                        var spokenByPlayerBOOL = document.getElementById(b + "-spoken").value;
                        if (spokenByPlayerBOOL == "o") {
                            spokenByPlayerBOOL = false;
                        } else {
                            spokenByPlayerBOOL = true;
                        }


                        //split into parts and then push to trimmed list
                        trimmedTextList.push([boxList[b].split("/"), spokenByPlayerBOOL]);
                    }
                }
            }


            //user input functions
            function handleKeyPress(u) {
                //updating the stored values 
                window.setTimeout(updateStoredText, 1);
                updateCanvas();
            }

            function addTextBox() {
                //text box format: [box] [character speaking selection] [add box above] [add box below] [remove this box]
                var html = `<input type="text" size="50" id="${boxNextID}-text"></input> 
                            <select id="${boxNextID}-spoken" onchange="updateStoredText()">
                                <optgroup label="Character Speaking">
                                    <option value="o">Orb</option>
                                    <option value="p">Player</option>
                                </optgroup>
                            </select>
                            <button onclick="removeTextBox(${boxNextID})">delete this box</button>`;
                addElement("textBoxArea", "div", "" + boxNextID, html);
                boxList.push(null);
                boxNextID += 1;
            }

            function addElement(parentId, elementTag, elementId, html) {
                // Adds an element to the document
                var p = document.getElementById(parentId);
                var newElement = document.createElement(elementTag);
                newElement.setAttribute('id', elementId);
                newElement.innerHTML = html;
                p.appendChild(newElement);
            }

            function removeTextBox(ID) {
                var element = document.getElementById("" + ID);
                element.parentNode.removeChild(element);
            }

            
        </script>
	</head>
	<body>
        <!--text area-->
        <div id="textBoxArea">

            <div id="0">
                <input type="text" size="50" id="0-text"></input> 
                <select id="0-spoken" onchange="updateStoredText()">
                    <optgroup label="Character Speaking">
                        <option value="o">Orb</option>
                        <option value="p">Player</option>
                    </optgroup>
                </select>
                <button onclick="removeTextBox(0)">delete this box</button>
            </div>
        
        </div>
        <button onclick="addTextBox()">Add a line</button>
        <br>
	    <canvas id="coco" width="640" height="480"></canvas>
	</body>
</html>

